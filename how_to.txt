Login and Register + JWT + Password Hash

1. Create Folder name Entities (Database Model)
2. Inside the Entities folder create file name User.cs (Add Entity )
3. Inside the Entities folder create Folder name Models
4. Inside the Models create file name UserDto.cs
	 a. UserDTO is the data that the client will send to the server
     b. The Dto is the data that we send back to the client after processing the request

5. Create Folder name Controllers 
6. inside controllers folder create file name UserController.cs
5. Add Logic of UserController

7. To has password we use Built in function from c# like following:
	var hashedPassowrd = new PasswordHasher<User>().HashPassword(user, request.Password);
8. To Verify hashed Passowrd we use the same built in function like following:
	var result = new PasswordHasher<User>().VerifyHashedPassword(user, user.PasswordHash, request.Password) == PasswordVerificationResult.Failed;

9. To run software we use package name scalar.AspNetCore(2.11.10)
10 install scalar with nuget package manager (Visit localhost at: https://localhost:7003/scalar/)
11. add following code inside program.cs as following:

	if (app.Environment.IsDevelopment())
	{
		app.MapScalarApiReference();
	}


12. To use JWT we install System.IdentityModel.Tokens.Jwt
13. And use the JWT as follwing:
    private string createToken(User user)
        {
            // We create claim to store username and other information
            var claims = new List<Claim>
            {
                new Claim(ClaimTypes.Name, user.Username)
            };

            var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(configuration.GetValue<string>("AppSettings:Token")!));

            var creds = new SigningCredentials(key, SecurityAlgorithms.HmacSha512);

            var tokenDescriptor = new JwtSecurityToken(
                issuer: configuration.GetValue<string>("AppSettings.Issuer"),
                audience: configuration.GetValue<string>("AppSettings:Audience"),
                claims: claims,
                expires: DateTime.UtcNow.AddDays(1),
                signingCredentials:creds
                );
            return new JwtSecurityTokenHandler().WriteToken(tokenDescriptor);
        }


Git hub push =======================================>

Database configuration
1. Create new folder name Data
2. inside the data folder create file name DbContext.cs
3. Install Package name Microsoft.EntityFrameworkCore with correct version
4. install Package name Microsoft.EntityFrameworkCore.SqlServer with correct version
5. Install Package name Microsoft.EntityFrameworkCore.Tools with correct version
4. Add logic for DbContext.cs configurations
5. register DbContext inside program.cs as following:
    builder.Services.AddDbContext<DataContext>(options =>
    {
        options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection"));
    });
6. Add Connection string inside appsettings.json as following:
  "ConnectionStrings": {
    "DefaultConnectionString": "Server="
    }
7. Open Sql Server Management Studio and create new database
8. Open SQL Server configuration and copy the connection string and paste inside appsettings.json
9. Open Package Manager Console and run following commands:
   a. Add-Migration InitialCreate
   b. Update-Database
10. Run the update-database command to create the database tables based on your DbContext and entity configurations.

Git hub push ======================================>
1. Create new folder name services
2. inside the services folder create file name AuthService.cs
3. inside the services folder create file name IAuthService.cs
4. Add logic for AuthService and IAuthService
5. register AuthService inside program.cs as following:
    builder.Services.AddScoped<IAuthService, AuthService>();
6. Create ResponseDto from every service to handle response like following:
   public class AuthLoginResponseDto
    {
        public UserDto User { get; set; }
        public string Token { get; set; }   
    }

Git hub push ======================================>
Sequre the API with JWT Bearer Authentication

1. Install Package name Microsoft.AspNetCore.Authentication.JwtBearer
2. register JWT Bearer Authentication inside program.cs as following:
    builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
        .AddJwtBearer(options =>
        {
            options.TokenValidationParameters = new TokenValidationParameters
            {
                ValidateIssuerSigningKey = true,
                IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(builder.Configuration.GetValue<string>("AppSettings:Token")!)),
                ValidateIssuer = true,
                ValidateAudience = true,
                ValidIssuer = builder.Configuration.GetValue<string>("AppSettings.Issuer"),
                ValidAudience = builder.Configuration.GetValue<string>("AppSettings:Audience"),
            };
        });

3. add app.UseAuthentication(); before app.UseAuthorization(); inside program.cs
4. add [Authorize] attribute above the controller or action method to protect it

Git hub push ======================================>

Adding Roles to the User Model
1. Update User Entity to include Role property
   public string Role { get; set; }
2. Update the dbContext and create new migration
    add-migration AddUserRole
3. Create new endpoint inside UserController for assigning roles
    [Authorize(Roles = "Admin")]
    [HttpGet("admin")]
    public ActionResult AdminOnlyEndpoint()
    {
        return Ok("You are an admin!");
    }
4. Update Claims in createToken method to include Role claim
    claims.Add(new Claim(ClaimTypes.Role, user.Role));
5. Update the controller methods to use role-based authorization

6. The Role in [Authorize(roles="admin")] must match the Role assigned to the user during registration or through role assignment.

Git hub push ======================================>

Implementing Refresh Tokens for JWT
1. Update User Entity to include RefreshToken and RefreshTokenExpiryTime properties
   public string RefreshToken { get; set; }
   public DateTime RefreshTokenExpiryTime { get; set; }
2. Add Migration for the new properties
    add-migration AddRefreshTokenToUser
3. Create endpoint for generating refresh tokens
    [HttpPost("refresh-token")]
    public ActionResult RefreshToken([FromBody] TokenRequestDto request)
    {
        // Validate the refresh token and generate a new JWT
    }
4. Create EndPoint to save Refresh Token in Database
    [HttpPost("save-refresh-token")]
    public ActionResult SaveRefreshToken([FromBody] SaveRefreshTokenDto request)
    {
        // Save the refresh token and its expiry time in the database
    }

5. Create new Service to validate the refresh token.
